{
	# No automatic HTTPS inside Docker — users put their own reverse proxy in front
	auto_https off
}

:80 {
	# API & backend endpoints → Rust backend
	handle /api/* {
		reverse_proxy localhost:3000 {
			header_up X-Real-IP {remote_host}
			# SSE: disable response buffering so event streams flush immediately
			flush_interval -1
		}
	}

	# Everything else → Next.js dashboard
	handle {
		reverse_proxy localhost:3001 {
			header_up X-Real-IP {remote_host}
		}
	}
}
